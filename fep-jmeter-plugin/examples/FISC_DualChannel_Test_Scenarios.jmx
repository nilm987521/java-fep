<?xml version="1.0" encoding="UTF-8"?>
<jmeterTestPlan version="1.2" properties="5.0" jmeter="5.6.3">
  <hashTree>
    <TestPlan guiclass="TestPlanGui" testclass="TestPlan" testname="FISC Dual-Channel Test Scenarios" enabled="true">
      <stringProp name="TestPlan.comments">完整測試場景：包含成功、餘額不足、逾時等模擬</stringProp>
      <boolProp name="TestPlan.functional_mode">false</boolProp>
      <boolProp name="TestPlan.tearDown_on_shutdown">true</boolProp>
      <boolProp name="TestPlan.serialize_threadgroups">false</boolProp>
      <elementProp name="TestPlan.user_defined_variables" elementType="Arguments" guiclass="ArgumentsPanel" testclass="Arguments" testname="User Defined Variables" enabled="true">
        <collectionProp name="Arguments.arguments"/>
      </elementProp>
      <stringProp name="TestPlan.user_define_classpath"></stringProp>
    </TestPlan>
    <hashTree>

      <!-- ========================================== -->
      <!-- 場景 1: 全部成功                            -->
      <!-- ========================================== -->
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="場景1: 全部交易成功" enabled="true">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="Loop Controller" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <intProp name="LoopController.loops">-1</intProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">0</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
      </ThreadGroup>
      <hashTree>
        <com.fep.jmeter.sampler.FiscDualChannelServerSampler guiclass="TestBeanGUI" testclass="com.fep.jmeter.sampler.FiscDualChannelServerSampler" testname="FISC Server - 全部成功" enabled="true">
          <intProp name="sendPort">9000</intProp>
          <intProp name="receivePort">9001</intProp>
          <intProp name="sampleInterval">1000</intProp>
          <stringProp name="defaultResponseCode">00</stringProp>
          <intProp name="responseDelay">50</intProp>
          <stringProp name="balanceAmount">5000000</stringProp>
          <boolProp name="enableValidation">true</boolProp>
          <stringProp name="validationErrorCode">30</stringProp>
          <stringProp name="validationRules">{"globalRules": {"required": [2, 3, 4, 11, 41]}}</stringProp>
          <boolProp name="enableBankIdRouting">true</boolProp>
          <intProp name="bankIdField">32</intProp>
          <!-- 所有交易類型都回傳 00 (成功) -->
          <stringProp name="responseRules">010000:00;400000:00;310000:00;300000:00</stringProp>
          <stringProp name="customResponseFields">43:SUCCESS TEST MERCHANT;49:901</stringProp>
        </com.fep.jmeter.sampler.FiscDualChannelServerSampler>
        <hashTree/>
      </hashTree>

      <!-- ========================================== -->
      <!-- 場景 2: 模擬餘額不足                        -->
      <!-- ========================================== -->
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="場景2: 轉帳餘額不足" enabled="false">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="Loop Controller" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <intProp name="LoopController.loops">-1</intProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">0</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
      </ThreadGroup>
      <hashTree>
        <com.fep.jmeter.sampler.FiscDualChannelServerSampler guiclass="TestBeanGUI" testclass="com.fep.jmeter.sampler.FiscDualChannelServerSampler" testname="FISC Server - 轉帳餘額不足" enabled="true">
          <intProp name="sendPort">9000</intProp>
          <intProp name="receivePort">9001</intProp>
          <intProp name="sampleInterval">1000</intProp>
          <stringProp name="defaultResponseCode">00</stringProp>
          <intProp name="responseDelay">50</intProp>
          <stringProp name="balanceAmount">100</stringProp>
          <boolProp name="enableValidation">true</boolProp>
          <stringProp name="validationErrorCode">30</stringProp>
          <stringProp name="validationRules">{"globalRules": {"required": [2, 3, 4, 11, 41]}}</stringProp>
          <boolProp name="enableBankIdRouting">true</boolProp>
          <intProp name="bankIdField">32</intProp>
          <!-- 提款成功，但轉帳回傳 51 (餘額不足) -->
          <stringProp name="responseRules">010000:00;400000:51;310000:00;300000:00</stringProp>
          <stringProp name="customResponseFields">43:INSUFFICIENT FUNDS TEST;49:901</stringProp>
        </com.fep.jmeter.sampler.FiscDualChannelServerSampler>
        <hashTree/>
      </hashTree>

      <!-- ========================================== -->
      <!-- 場景 3: 模擬高延遲 (逾時測試)               -->
      <!-- ========================================== -->
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="場景3: 高延遲回應" enabled="false">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="Loop Controller" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <intProp name="LoopController.loops">-1</intProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">0</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
      </ThreadGroup>
      <hashTree>
        <com.fep.jmeter.sampler.FiscDualChannelServerSampler guiclass="TestBeanGUI" testclass="com.fep.jmeter.sampler.FiscDualChannelServerSampler" testname="FISC Server - 高延遲" enabled="true">
          <intProp name="sendPort">9000</intProp>
          <intProp name="receivePort">9001</intProp>
          <intProp name="sampleInterval">1000</intProp>
          <stringProp name="defaultResponseCode">00</stringProp>
          <!-- 設定 3 秒延遲，用於測試客戶端逾時處理 -->
          <intProp name="responseDelay">3000</intProp>
          <stringProp name="balanceAmount">1000000</stringProp>
          <boolProp name="enableValidation">false</boolProp>
          <stringProp name="validationErrorCode">30</stringProp>
          <stringProp name="validationRules"></stringProp>
          <boolProp name="enableBankIdRouting">true</boolProp>
          <intProp name="bankIdField">32</intProp>
          <stringProp name="responseRules">010000:00;400000:00;310000:00;300000:00</stringProp>
          <stringProp name="customResponseFields">43:SLOW RESPONSE TEST;49:901</stringProp>
        </com.fep.jmeter.sampler.FiscDualChannelServerSampler>
        <hashTree/>
      </hashTree>

      <!-- ========================================== -->
      <!-- 場景 4: 模擬系統故障                        -->
      <!-- ========================================== -->
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="場景4: 系統故障回應" enabled="false">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="Loop Controller" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <intProp name="LoopController.loops">-1</intProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">0</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
      </ThreadGroup>
      <hashTree>
        <com.fep.jmeter.sampler.FiscDualChannelServerSampler guiclass="TestBeanGUI" testclass="com.fep.jmeter.sampler.FiscDualChannelServerSampler" testname="FISC Server - 系統故障" enabled="true">
          <intProp name="sendPort">9000</intProp>
          <intProp name="receivePort">9001</intProp>
          <intProp name="sampleInterval">1000</intProp>
          <!-- 預設回傳 96 (系統故障) -->
          <stringProp name="defaultResponseCode">96</stringProp>
          <intProp name="responseDelay">100</intProp>
          <stringProp name="balanceAmount"></stringProp>
          <boolProp name="enableValidation">false</boolProp>
          <stringProp name="validationErrorCode">30</stringProp>
          <stringProp name="validationRules"></stringProp>
          <boolProp name="enableBankIdRouting">true</boolProp>
          <intProp name="bankIdField">32</intProp>
          <!-- 所有交易都回傳 96 -->
          <stringProp name="responseRules">010000:96;400000:96;310000:96;300000:96</stringProp>
          <stringProp name="customResponseFields">43:SYSTEM ERROR TEST;49:901</stringProp>
        </com.fep.jmeter.sampler.FiscDualChannelServerSampler>
        <hashTree/>
      </hashTree>

      <!-- ========================================== -->
      <!-- 場景 5: 嚴格欄位驗證                        -->
      <!-- ========================================== -->
      <ThreadGroup guiclass="ThreadGroupGui" testclass="ThreadGroup" testname="場景5: 嚴格欄位驗證" enabled="false">
        <stringProp name="ThreadGroup.on_sample_error">continue</stringProp>
        <elementProp name="ThreadGroup.main_controller" elementType="LoopController" guiclass="LoopControlPanel" testclass="LoopController" testname="Loop Controller" enabled="true">
          <boolProp name="LoopController.continue_forever">false</boolProp>
          <intProp name="LoopController.loops">-1</intProp>
        </elementProp>
        <stringProp name="ThreadGroup.num_threads">1</stringProp>
        <stringProp name="ThreadGroup.ramp_time">0</stringProp>
        <boolProp name="ThreadGroup.scheduler">false</boolProp>
        <stringProp name="ThreadGroup.duration"></stringProp>
        <stringProp name="ThreadGroup.delay"></stringProp>
        <boolProp name="ThreadGroup.same_user_on_next_iteration">true</boolProp>
      </ThreadGroup>
      <hashTree>
        <com.fep.jmeter.sampler.FiscDualChannelServerSampler guiclass="TestBeanGUI" testclass="com.fep.jmeter.sampler.FiscDualChannelServerSampler" testname="FISC Server - 嚴格驗證" enabled="true">
          <intProp name="sendPort">9000</intProp>
          <intProp name="receivePort">9001</intProp>
          <intProp name="sampleInterval">1000</intProp>
          <stringProp name="defaultResponseCode">00</stringProp>
          <intProp name="responseDelay">50</intProp>
          <stringProp name="balanceAmount">1000000</stringProp>
          <boolProp name="enableValidation">true</boolProp>
          <!-- 驗證失敗回傳 30 (格式錯誤) -->
          <stringProp name="validationErrorCode">30</stringProp>
          <!-- 完整的驗證規則 -->
          <stringProp name="validationRules">{
  "globalRules": {
    "required": [2, 3, 4, 11, 12, 13, 32, 37, 41, 42, 49],
    "format": {
      "2": "N(13-19)", "3": "N(6)", "4": "N(12)", "11": "N(6)",
      "12": "N(6)", "13": "N(4)", "32": "N(3-11)", "49": "N(3)"
    },
    "value": {"3": ["010000", "400000", "310000", "300000", "012000"]},
    "length": {"4": 12, "11": 6, "12": 6, "13": 4},
    "pattern": {"37": "^[A-Z0-9]{12}$"}
  }
}</stringProp>
          <boolProp name="enableBankIdRouting">true</boolProp>
          <intProp name="bankIdField">32</intProp>
          <stringProp name="responseRules">010000:00;400000:00;310000:00;300000:00</stringProp>
          <stringProp name="customResponseFields">43:STRICT VALIDATION TEST;49:901</stringProp>
        </com.fep.jmeter.sampler.FiscDualChannelServerSampler>
        <hashTree/>
      </hashTree>

      <!-- ========================================== -->
      <!-- Listeners                                   -->
      <!-- ========================================== -->
      <ResultCollector guiclass="ViewResultsFullVisualizer" testclass="ResultCollector" testname="View Results Tree" enabled="true">
        <boolProp name="ResultCollector.error_logging">false</boolProp>
        <objProp>
          <name>saveConfig</name>
          <value class="SampleSaveConfiguration">
            <time>true</time>
            <latency>true</latency>
            <timestamp>true</timestamp>
            <success>true</success>
            <label>true</label>
            <code>true</code>
            <message>true</message>
            <threadName>true</threadName>
            <dataType>true</dataType>
            <encoding>false</encoding>
            <assertions>true</assertions>
            <subresults>true</subresults>
            <responseData>true</responseData>
            <samplerData>true</samplerData>
            <xml>false</xml>
            <fieldNames>true</fieldNames>
            <responseHeaders>false</responseHeaders>
            <requestHeaders>false</requestHeaders>
            <responseDataOnError>false</responseDataOnError>
            <saveAssertionResultsFailureMessage>true</saveAssertionResultsFailureMessage>
            <assertionsResultsToSave>0</assertionsResultsToSave>
            <bytes>true</bytes>
            <sentBytes>true</sentBytes>
            <url>true</url>
            <threadCounts>true</threadCounts>
            <idleTime>true</idleTime>
            <connectTime>true</connectTime>
          </value>
        </objProp>
        <stringProp name="filename"></stringProp>
      </ResultCollector>
      <hashTree/>

      <ResultCollector guiclass="SummaryReport" testclass="ResultCollector" testname="Summary Report" enabled="true">
        <boolProp name="ResultCollector.error_logging">false</boolProp>
        <objProp>
          <name>saveConfig</name>
          <value class="SampleSaveConfiguration">
            <time>true</time>
            <latency>true</latency>
            <timestamp>true</timestamp>
            <success>true</success>
            <label>true</label>
            <code>true</code>
            <message>true</message>
            <threadName>true</threadName>
            <dataType>true</dataType>
            <encoding>false</encoding>
            <assertions>true</assertions>
            <subresults>true</subresults>
            <responseData>false</responseData>
            <samplerData>false</samplerData>
            <xml>false</xml>
            <fieldNames>true</fieldNames>
            <responseHeaders>false</responseHeaders>
            <requestHeaders>false</requestHeaders>
            <responseDataOnError>false</responseDataOnError>
            <saveAssertionResultsFailureMessage>true</saveAssertionResultsFailureMessage>
            <assertionsResultsToSave>0</assertionsResultsToSave>
            <bytes>true</bytes>
            <sentBytes>true</sentBytes>
            <url>true</url>
            <threadCounts>true</threadCounts>
            <idleTime>true</idleTime>
            <connectTime>true</connectTime>
          </value>
        </objProp>
        <stringProp name="filename"></stringProp>
      </ResultCollector>
      <hashTree/>

    </hashTree>
  </hashTree>
</jmeterTestPlan>
